var EXIF=function(){function c(e,s){s||e.match(/^data\:([^\;]+)\;base64,/mi);for(var e=e.replace(/^data\:([^\;]+)\;base64,/gmi,""),a=atob(e),f=a.length,j=new ArrayBuffer(f),b=new Uint8Array(j),c=0;c<f;c++)b[c]=a.charCodeAt(c);return j}function b(e,s){var a=new XMLHttpRequest;a.open("GET",e,true);a.responseType="blob";a.onload=function(){(this.status==200||this.status===0)&&s(this.response)};a.send()}function d(e,s){function f(c){c=a(c);e.exifdata=c||{};s&&s.call(e)}if(e instanceof Image||e instanceof
HTMLImageElement)if(/^data\:/i.test(e.src)){var k=c(e.src);f(k)}else if(/^blob\:/i.test(e.src)){var j=new FileReader;j.onload=function(e){f(e.target.result)};b(e.src,function(e){j.readAsArrayBuffer(e)})}else{var g=new XMLHttpRequest;g.onload=function(){if(g.status=="200")f(g.response);else throw"Could not load image";g=null};g.open("GET",e.src,true);g.responseType="arraybuffer";g.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File))j=new FileReader,j.onload=function(e){i&&
console.log("Got file of length "+e.target.result.byteLength);f(e.target.result)},j.readAsArrayBuffer(e)}function a(e){var s=new DataView(e);i&&console.log("Got file of length "+e.byteLength);if(s.getUint8(0)!=255||s.getUint8(1)!=216)return i&&console.log("Not a valid JPEG"),false;for(var a=2,e=e.byteLength,f;a<e;){if(s.getUint8(a)!=255)return i&&console.log("Not a valid marker at offset "+a+", found: "+s.getUint8(a)),false;f=s.getUint8(a+1);i&&console.log(f);if(f==225)return i&&console.log("Found 0xFFE1 marker"),
p(s,a+4,s.getUint16(a+2)-2);else a+=2+s.getUint16(a+2)}}function o(e,a,f,c,b){var g=e.getUint16(f,!b),q={},o,r,h;for(h=0;h<g;h++)o=f+h*12+2,r=c[e.getUint16(o,!b)],!r&&i&&console.log("Unknown tag: "+e.getUint16(o,!b)),q[r]=l(e,o,a,f,b);return q}function l(e,a,f,c,b){var g=e.getUint16(a+2,!b),c=e.getUint32(a+4,!b),f=e.getUint32(a+8,!b)+f,q,o;switch(g){case 1:case 7:if(c==1)return e.getUint8(a+8,!b);else{f=c>4?f:a+8;a=[];for(g=0;g<c;g++)a[g]=e.getUint8(f+g);return a}case 2:return h(e,c>4?f:a+8,c-1);
case 3:if(c==1)return e.getUint16(a+8,!b);else{f=c>2?f:a+8;a=[];for(g=0;g<c;g++)a[g]=e.getUint16(f+2*g,!b);return a}case 4:if(c==1)return e.getUint32(a+8,!b);else{a=[];for(g=0;g<c;g++)a[g]=e.getUint32(f+4*g,!b);return a}case 5:if(c==1)return q=e.getUint32(f,!b),o=e.getUint32(f+4,!b),e=new Number(q/o),e.numerator=q,e.denominator=o,e;else{a=[];for(g=0;g<c;g++)q=e.getUint32(f+8*g,!b),o=e.getUint32(f+4+8*g,!b),a[g]=new Number(q/o),a[g].numerator=q,a[g].denominator=o;return a}case 9:if(c==1)return e.getInt32(a+
8,!b);else{a=[];for(g=0;g<c;g++)a[g]=e.getInt32(f+4*g,!b);return a}case 10:if(c==1)return e.getInt32(f,!b)/e.getInt32(f+4,!b);else{a=[];for(g=0;g<c;g++)a[g]=e.getInt32(f+8*g,!b)/e.getInt32(f+4+8*g,!b);return a}}}function h(a,f,c){var b="";for(n=f;n<f+c;n++)b+=String.fromCharCode(a.getUint8(n));return b}function p(a,c){if(h(a,c,4)!="Exif")return i&&console.log("Not valid EXIF data! "+h(a,c,4)),false;var b,d,j,g,l=c+6;if(a.getUint16(l)==18761)b=false;else if(a.getUint16(l)==19789)b=true;else return i&&
console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),false;if(a.getUint16(l+2,!b)!=42)return i&&console.log("Not valid TIFF data! (no 0x002A)"),false;d=a.getUint32(l+4,!b);if(d<8)return i&&console.log("Not valid TIFF data! (First offset less than 8)",a.getUint32(l+4,!b)),false;d=o(a,l,l+d,q,b);if(d.ExifIFDPointer)for(j in g=o(a,l,l+d.ExifIFDPointer,m,b),g){switch(j){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":g[j]=
r[j][g[j]];break;case "ExifVersion":case "FlashpixVersion":g[j]=String.fromCharCode(g[j][0],g[j][1],g[j][2],g[j][3]);break;case "ComponentsConfiguration":g[j]=r.Components[g[j][0]]+r.Components[g[j][1]]+r.Components[g[j][2]]+r.Components[g[j][3]]}d[j]=g[j]}if(d.GPSInfoIFDPointer)for(j in b=o(a,l,l+d.GPSInfoIFDPointer,f,b),b){switch(j){case "GPSVersionID":b[j]=b[j][0]+"."+b[j][1]+"."+b[j][2]+"."+b[j][3]}d[j]=b[j]}return d}var i=false,m={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",
40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",
37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",
41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},q={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",
530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},f={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",
3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",
29:"GPSDateStamp",30:"GPSDifferential"},r={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",
13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",
16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},
SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",
1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};return{readFromBinaryFile:function(f){return a(f)},pretty:function(a){if(!a.exifdata)return"";var f,a=a.exifdata,b="";for(f in a)a.hasOwnProperty(f)&&(b+=typeof a[f]=="object"?a[f]instanceof Number?f+" : "+a[f]+" ["+a[f].numerator+"/"+a[f].denominator+"]\r\n":f+" : ["+a[f].length+" values]\r\n":f+" : "+a[f]+"\r\n");return b},getTag:function(a,f){return!a.exifdata?void 0:a.exifdata[f]},
getAllTags:function(a){if(!a.exifdata)return{};var f,a=a.exifdata,b={};for(f in a)a.hasOwnProperty(f)&&(b[f]=a[f]);return b},getData:function(a,f){if((a instanceof Image||a instanceof HTMLImageElement)&&!a.complete)return false;a.exifdata?f&&f.call(a):d(a,f);return true},Tags:m,TiffTags:q,GPSTags:f,StringValues:r}}();
(function(){function c(a,c,d){var h=document.createElement("canvas");b(a,h,c,d);return h.toDataURL("image/jpeg",c.quality||0.8)}function b(a,b,c,d){var p=a.naturalWidth,i=a.naturalHeight,m=c.width,q=c.height,f=b.getContext("2d");f.save();c=c.orientation;switch(c){case 5:case 6:case 7:case 8:b.width=q;b.height=m;break;default:b.width=m,b.height=q}switch(c){case 2:f.translate(m,0);f.scale(-1,1);break;case 3:f.translate(m,q);f.rotate(Math.PI);break;case 4:f.translate(0,q);f.scale(1,-1);break;case 5:f.rotate(0.5*
Math.PI);f.scale(1,-1);break;case 6:f.rotate(0.5*Math.PI);f.translate(0,-q);break;case 7:f.rotate(0.5*Math.PI);f.translate(m,-q);f.scale(-1,1);break;case 8:f.rotate(-0.5*Math.PI),f.translate(-m,0)}b=a.naturalWidth;b*a.naturalHeight>1048576?(c=document.createElement("canvas"),c.width=c.height=1,c=c.getContext("2d"),c.drawImage(a,-b+1,0),b=c.getImageData(0,0,1,1).data[3]===0):b=false;b&&(p/=2,i/=2);b=document.createElement("canvas");b.width=b.height=1024;c=b.getContext("2d");if(d){var d=i,r=document.createElement("canvas");
r.width=1;r.height=d;r=r.getContext("2d");r.drawImage(a,0,0);for(var r=r.getImageData(0,0,1,d).data,e=0,s=d,t=d;t>e;)r[(t-1)*4+3]===0?s=t:e=t,t=s+e>>1;d=t/d;d=d===0?1:d}else d=1;m=Math.ceil(1024*m/p);q=Math.ceil(1024*q/i/d);for(r=d=0;d<i;){for(s=e=0;e<p;)c.clearRect(0,0,1024,1024),c.drawImage(a,-e,-d),f.drawImage(b,0,0,1024,1024,s,r,m,q),e+=1024,s+=m;d+=1024;r+=q}f.restore()}function d(a){if(window.Blob&&a instanceof Blob){var b=new Image,c=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&
window.webkitURL.createObjectURL?window.webkitURL:null;if(!c)throw Error("No createObjectURL function found to create blob url");b.src=c.createObjectURL(a);this.blob=a;a=b}if(!a.naturalWidth&&!a.naturalHeight){var d=this;this.srcImage.onload=function(){var a=d.imageLoadListeners;if(a){d.imageLoadListeners=null;for(var b=0,c=a.length;b<c;b++)a[b]()}};this.imageLoadListeners=[]}this.srcImage=a}d.prototype.render=function(a,d){if(this.imageLoadListeners){var l=this;this.imageLoadListeners.push(function(){l.render(a,
d)})}else{var d=d||{},h=this.srcImage.naturalWidth,p=this.srcImage.naturalHeight,i=d.width,m=d.height,q=d.maxWidth,f=d.maxHeight,r=!this.blob||this.blob.type==="image/jpeg";i&&!m?m=p*i/h<<0:m&&!i?i=h*m/p<<0:(i=h,m=p);q&&i>q&&(i=q,m=p*i/h<<0);f&&m>f&&(m=f,i=h*m/p<<0);var h={width:i,height:m},e;for(e in d)h[e]=d[e];e=a.tagName.toLowerCase();e==="img"?a.src=c(this.srcImage,h,r):e==="canvas"&&b(this.srcImage,a,h,r);if(typeof this.onrender==="function")this.onrender(a)}};typeof define==="function"&&define.amd?
define([],function(){return d}):this.MegaPixImage=d})();function resizeToCover(c,b,d,a){d/a<c/b?(c*=a/b,b=a):(b*=d/c,c=d);return{width:c,height:b}}function resizeToContain(c,b,d,a){d/a<c/b?(b*=d/c,c=d):(c*=a/b,b=a);return{width:c,height:b}}
(function(c,b){b.support.filereader=!(!c.File||!c.FileReader||!c.FileList||!c.Blob);var d={width:0,height:0,bgcolor:"#fff",type:"image/jpeg",size:"contain",success:null,progress:null,error:null},a=/^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;b.fn.ThumbNail=
function(c){function l(){q=b("<canvas></canvas>");f=q[0];f.width=h.width;f.height=h.height;r=f.getContext("2d");v=new MegaPixImage(e);var a=this.exifdata.Orientation,c,d;j=e.width;g=e.height;if(h.bgcolor)r.fillStyle=h.bgcolor,r.fillRect(0,0,f.width,f.height);switch(a){case 5:case 6:case 7:case 8:c=h.height;d=h.width;break;default:c=h.width,d=h.height}switch(p){case "contain":k=resizeToContain(j,g,c,d);break;case "cover":k=resizeToCover(j,g,c,d);break;default:k={width:j,height:g}}v.render(f,{width:k.width,
height:k.height,quality:1,orientation:a});a=k.width/j;r.save();r.transform(a,0,0,a,0,0);r.restore();s=f.toDataURL(h.type,1);b.isFunction(h.success)&&(t={width:j,height:g},h.success.apply(self,[s,t,k,i]))}if(b.support.filereader){var h={};b.extend(h,d,c);var p=h.size,i,m,q,f,r,e,s,t,k,j,g,v;this.on("change",function(){var f=this,c=f.files;s="";if(c.length)i=c[0],a.test(i.type)?(b.isFunction(h.progress)&&h.progress.call(this),m=new FileReader,m.onerror=function(a){b.isFunction(h.error)&&h.error.apply(f,
[i,a])},m.onload=function(a){a=a.target.result;e=new Image;e.onload=function(){EXIF.getData(i,l)};e.src=a},m.readAsDataURL(i)):alert("error!")})}else this.ieThumbNail(c)}})(window,jQuery);(function(c,b){function d(a,c,d,h){this.opts={width:a.width,height:a.height,min_scale:1,drag:true,rect:true,pinch:true,rotate:false};for(var p in h)this.opts[p]=h[p];this.canvas=a;this.ctx=a.getContext("2d");this.img=d;this.ctrl=c;b.defaults.behavior.touchAction="pan-y";this.width=a.width=this.opts.width;this.height=a.height=this.opts.height;this.imgw=this.img.width;this.imgh=this.img.height;this.init()}d.prototype={x:0,y:0,isdrag:false,istransform:false,scale:1,rotation:0,canDrag:false,canPinch:false,
canRotate:false,fitRect:true,getData:function(a){with(this)return canvas.toDataURL(a||"image/png",1)},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},setImage:function(a){this.img=a;this.istransform=this.isdrag=false;this.scale=1;this.deltaY=this.deltaX=this.rotation=0;this.last_scale=1;this.last_rotation=0;this.startX=-(this.img.width-this.canvas.width)>>1;this.startY=-(this.img.height-this.canvas.height)>>1;this.centerX=this.startX;this.centerY=this.startY;this.ctx.setTransform(1,
0,0,1,0,0);this.redrawImage(this.img.width/2,this.img.height/2)},init:function(){var a=this;this.canDrag=this.opts.drag;this.canPinch=this.opts.pinch;this.canRotate=this.opts.rotate;this.fitRect=this.opts.rect;if(this.canPinch==true||this.canRotate==true)this.fitRect=false;this.hammer=b(this.ctrl,{swipe:false,hold:false,preventDefault:true});this.deltaY=this.deltaX=0;this.last_scale=1;this.last_rotation=0;this.startX=-(this.img.width-this.canvas.width)>>1;this.startY=-(this.img.height-this.canvas.height)>>
1;this.centerX=this.startX;this.centerY=this.startY;this.ctx.setTransform(1,0,0,1,0,0);this.redrawImage(this.img.width/2,this.img.height/2);this.hammer.on("dragstart dragend transformstart transformend",function(b){switch(b.type){case "dragstart":a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height);break;case "dragend":if(a.isdrag&&!a.istransform)a.startX+=a.deltaX,a.startY+=a.deltaY,a.deltaX=a.deltaY=0,a.isdrag=false;break;case "transformstart":a.istransform=true;break;case "transformend":a.deltaX=
a.deltaY=0,a.last_scale=a.scale,a.last_rotation=a.rotation,setTimeout(function(){a.istransform=false},100)}});this.hammer.on("drag transform",function(b){a.isdrag=true;switch(b.type){case "drag":if(!a.istransform&&a.canDrag)a.deltaX=b.gesture.deltaX,a.deltaY=b.gesture.deltaY;break;case "transform":a.deltaX=0;a.deltaY=0;a.centerX=b.gesture.center.pageX;a.centerY=b.gesture.center.pageY;if(a.canRotate)a.rotation=a.last_rotation+b.gesture.rotation;if(a.canPinch)a.scale=a.last_scale*b.gesture.scale}a.redrawImage.call(a)})},
redrawImage:function(){this.ctx.clearRect(0,0,this.width,this.height);this.scale=Math.max(this.opts.min_scale,this.scale);var a=this.width*(1-this.scale)>>1,b=this.height*(1-this.scale)>>1,c=this.centerX/this.scale,d=this.centerY/this.scale;this.ctx.save();this.x=this.startX+this.deltaX+a;this.y=this.startY+this.deltaY+b;if(this.fitRect&&(this.imgw>this.width||this.imgh>this.height))a=Math.abs(this.imgw-this.width),b=Math.abs(this.imgh-this.height),this.x=this.x>0?0:Math.abs(this.x)>a?a*-1:this.x,
this.y=this.y>0?0:Math.abs(this.y)>b?b*-1:this.y;this.ctx.translate(this.x,this.y);this.ctx.translate(c,d);this.ctx.scale(this.scale,this.scale);this.ctx.rotate(this.rotation*Math.PI/180);this.ctx.translate(-c,-d);this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height);this.ctx.restore()}};c.CanvasTransform=d})(window,Hammer);var CanvasImage=function(c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");document.body.appendChild(this.canvas);this.width=this.canvas.width=c.width;this.height=this.canvas.height=c.height;this.context.drawImage(c,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};CanvasImage.prototype.update=function(c){this.context.putImageData(c,0,0)};
CanvasImage.prototype.getPixelCount=function(){return this.width*this.height};CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};
if(ColorThief.prototype.getColor=function(c,b){return this.getPalette(c,5,b)[0]},ColorThief.prototype.getPalette=function(c,b,d){"undefined"==typeof b&&(b=10);"undefined"==typeof d&&(d=10);for(var a,o,l,h,p,c=new CanvasImage(c),i=c.getImageData().data,m=c.getPixelCount(),q=[],f=0;m>f;f+=d)a=4*f,o=i[a+0],l=i[a+1],h=i[a+2],p=i[a+3],p>=125&&(o>250&&l>250&&h>250||q.push([o,l,h]));b=MMCQ.quantize(q,b).palette();return c.removeCanvas(),b},!pv)var pv={map:function(c,b){var d={};return b?c.map(function(a,
c){return d.index=c,b.call(d,a)}):c.slice()},naturalOrder:function(c,b){return b>c?-1:c>b?1:0},sum:function(c,b){var d={};return c.reduce(b?function(a,c,l){return d.index=l,a+b.call(d,c)}:function(a,b){return a+b},0)},max:function(c,b){return Math.max.apply(null,b?pv.map(c,b):c)}};
var MMCQ=function(){function c(a,b,c){return(a<<2*p)+(b<<p)+c}function b(a){function b(){c.sort(a);d=true}var c=[],d=false;return{push:function(a){c.push(a);d=false},peek:function(a){return d||b(),void 0===a&&(a=c.length-1),c[a]},pop:function(){return d||b(),c.pop()},size:function(){return c.length},map:function(a){return c.map(a)},debug:function(){return d||b(),c}}}function d(a,b,c,d,i,h,k){this.r1=a;this.r2=b;this.g1=c;this.g2=d;this.b1=i;this.b2=h;this.histo=k}function a(){this.vboxes=new b(function(a,
b){return pv.naturalOrder(a.vbox.count()*a.vbox.volume(),b.vbox.count()*b.vbox.volume())})}function o(a){var b,d,e,h,t=Array(1<<3*p);return a.forEach(function(a){d=a[0]>>i;e=a[1]>>i;h=a[2]>>i;b=c(d,e,h);t[b]=(t[b]||0)+1}),t}function l(a,b){var c,e,h,t=1E6,k=0,j=1E6,g=0,l=1E6,m=0;return a.forEach(function(a){c=a[0]>>i;e=a[1]>>i;h=a[2]>>i;t>c?t=c:c>k&&(k=c);j>e?j=e:e>g&&(g=e);l>h?l=h:h>m&&(m=h)}),new d(t,k,j,g,l,m,b)}function h(a,b){function d(a){var c,e,g,j,q=a+"1",h=a+"2",i=0;for(k=b[q];k<=b[h];k++)if(o[k]>
p/2){for(a=b.copy(),g=b.copy(),c=k-b[q],e=b[h]-k,j=e>=c?Math.min(b[h]-1,~~(k+e/2)):Math.max(b[q],~~(k-1-c/2));!o[j];)j++;for(i=u[j];!i&&o[j-1];)i=u[--j];return a[h]=j,g[q]=a[h]+1,[a,g]}}if(b.count()){var e=b.r2-b.r1+1,h=b.g2-b.g1+1,i=pv.max([e,h,b.b2-b.b1+1]);if(1==b.count())return[b.copy()];var k,j,g,l,m,p=0,o=[],u=[];if(i==e)for(k=b.r1;k<=b.r2;k++){for(l=0,j=b.g1;j<=b.g2;j++)for(g=b.b1;g<=b.b2;g++)m=c(k,j,g),l+=a[m]||0;p+=l;o[k]=p}else if(i==h)for(k=b.g1;k<=b.g2;k++){for(l=0,j=b.r1;j<=b.r2;j++)for(g=
b.b1;g<=b.b2;g++)m=c(j,k,g),l+=a[m]||0;p+=l;o[k]=p}else for(k=b.b1;k<=b.b2;k++){for(l=0,j=b.r1;j<=b.r2;j++)for(g=b.g1;g<=b.g2;g++)m=c(j,g,k),l+=a[m]||0;p+=l;o[k]=p}return o.forEach(function(a,b){u[b]=p-a}),d(i==e?"r":i==h?"g":"b")}}var p=5,i=8-p,m=1E3;return d.prototype={volume:function(a){return(!this._volume||a)&&(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(a){var b=this.histo;if(!this._count_set||a){for(var d,e,h=0,a=this.r1;a<=this.r2;a++)for(d=
this.g1;d<=this.g2;d++)for(e=this.b1;e<=this.b2;e++)index=c(a,d,e),h+=b[index]||0;this._count=h;this._count_set=true}return this._count},copy:function(){return new d(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(a){var b=this.histo;if(!this._avg||a){for(var d,e,h,i,k=0,j=1<<8-p,g=0,l=0,m=0,a=this.r1;a<=this.r2;a++)for(e=this.g1;e<=this.g2;e++)for(h=this.b1;h<=this.b2;h++)i=c(a,e,h),d=b[i]||0,k+=d,g+=d*(a+0.5)*j,l+=d*(e+0.5)*j,m+=d*(h+0.5)*j;this._avg=k?[~~(g/k),~~(l/k),
~~(m/k)]:[~~(j*(this.r1+this.r2+1)/2),~~(j*(this.g1+this.g2+1)/2),~~(j*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(a){var b=a[0]>>i;return gval=a[1]>>i,bval=a[2]>>i,b>=this.r1&&b<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},a.prototype={push:function(a){this.vboxes.push({vbox:a,color:a.avg()})},palette:function(){return this.vboxes.map(function(a){return a.color})},size:function(){return this.vboxes.size()},map:function(a){for(var b=this.vboxes,c=0;c<b.size();c++)if(b.peek(c).vbox.contains(a))return b.peek(c).color;
return this.nearest(a)},nearest:function(a){for(var b,c,d,h=this.vboxes,i=0;i<h.size();i++)c=Math.sqrt(Math.pow(a[0]-h.peek(i).color[0],2)+Math.pow(a[1]-h.peek(i).color[1],2)+Math.pow(a[2]-h.peek(i).color[2],2)),(b>c||void 0===b)&&(b=c,d=h.peek(i).color);return d},forcebw:function(){var a=this.vboxes;a.sort(function(a,b){return pv.naturalOrder(pv.sum(a.color),pv.sum(b.color))});var b=a[0].color;b[0]<5&&b[1]<5&&b[2]<5&&(a[0].color=[0,0,0]);var b=a.length-1,c=a[b].color;c[0]>251&&c[1]>251&&c[2]>251&&
(a[b].color=[255,255,255])}},{quantize:function(c,d){function i(a,b){for(var c,d=1,f=0;m>f;)if(c=a.pop(),c.count()){var k=h(e,c),l=k[0],k=k[1];if(!l)break;if(a.push(l),k&&(a.push(k),d++),d>=b)break;if(f++>m)break}else a.push(c),f++}if(!c.length||2>d||d>256)return false;var e=o(c),p=0;e.forEach(function(){p++});var t=l(c,e),k=new b(function(a,b){return pv.naturalOrder(a.count(),b.count())});k.push(t);i(k,0.75*d);for(t=new b(function(a,b){return pv.naturalOrder(a.count()*a.volume(),b.count()*b.volume())});k.size();)t.push(k.pop());
i(t,d-t.size());for(k=new a;t.size();)k.push(t.pop());return k}}}();function checkScore(c,b){var d=rgbToXyz(b[0],b[1],b[2]),d=xyzToLab(d[0],d[1],d[2]),a=rgbToXyz(c[0],c[1],c[2]),a=xyzToLab(a[0],a[1],a[2]),d=cie1994(d,a,false);return parseFloat((100-d).toFixed(2))}function hslToRgb(c,b,d){if(b==0)d=b=c=d;else var a=function(a,b,c){c<0&&(c+=1);c>1&&(c-=1);return c<1/6?a+(b-a)*6*c:c<0.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a},o=d<0.5?d*(1+b):d+b-d*b,l=2*d-o,d=a(l,o,c+1/3),b=a(l,o,c),c=a(l,o,c-1/3);return[d*255,b*255,c*255].map(Math.round)}
function rgbToXyz(c,b,d){c/=255;b/=255;d/=255;c>0.04045?c=Math.pow((c+0.055)/1.055,2.4):c/=12.92;b>0.04045?b=Math.pow((b+0.055)/1.055,2.4):b/=12.92;d>0.04045?d=Math.pow((d+0.055)/1.055,2.4):d/=12.92;c*=100;b*=100;d*=100;X=c*0.4124+b*0.3576+d*0.1805;Y=c*0.2126+b*0.7152+d*0.0722;Z=c*0.0193+b*0.1192+d*0.9505;return[X,Y,Z]}
function xyzToLab(c,b,d){c/=95.047;b/=100;d/=108.883;c=c>0.008856?Math.pow(c,1/3):7.787*c+16/116;b=b>0.008856?Math.pow(b,1/3):7.787*b+16/116;d=d>0.008856?Math.pow(d,1/3):7.787*d+16/116;return[116*b-16,500*(c-b),200*(b-d)]}
function cie1994(c,b,d){c={l:c[0],a:c[1],b:c[2]};b={l:b[0],a:b[1],b:b[2]};labx=c;laby=b;var a,o;d?(a=0.014,o=0.048,d=2):(a=0.015,o=0.045,d=1);var l=Math.sqrt(c.a*c.a+c.b*c.b),h=Math.sqrt(b.a*b.a+b.b*b.b);a=1+a*l;o=1+o*l;var p=c.a-b.a,i=c.b-b.b;l-=h;c=c.l-b.l;b=Math.sqrt(p*p+i*i-l*l);return Math.sqrt(Math.pow(c/(d*1),2)+Math.pow(l/(1*o),2)+Math.pow(b/(1*a),2))};
